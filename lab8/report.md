#Lab8实验报告

##练习0：填写已有实验
按照要求填写Lab1-7的已有代码。

##练习1: 完成读文件操作的实现
###设计实现过程
实现sys\_io\_nolock的实现：

- 在第一块中如果开始的偏移没有对齐，这时我们就读到了第一个块中的不完整的部分。否则，我们就把它当成一个完全块或者最后一个块处理。
- 然后读区所有的完全块。
- 如果末尾地址和最后一块并没有对齐，那么我们就读到了最后一块不完整的部分。

###设计实现UNIX的PIPE机制的概要设计方案
为了实现PIPE，需要至少调用4个系统调用。

- pipe_open:创建一个新的pipe并返回它的句柄。
- pipe_read:从pipe中读取数据。如果没有数据可以读取，可以挂起直到等到所需要的数据；或者可以立即提示错误并返回。
- pipe_write:向pipe中写数据。如果pipe时满的，可以挂起等待pipe_read释放的空间，活着可以立即提示错误并返回。
- pipe_close:关闭所有的pipe并释放它所占用的内存。

pipe的实现上可以用一个封装的buffer，数据缓冲区来实现。


##练习2: 完成基于文件系统的执行程序机制的实现

###设计实现过程
改写proc.c中的load_icode函数和其他相关函数，实现基于文件系统的执行程序机制。

load_icode的实现与lab6和lab7中的类似，主要的区别是elf header，程序头和程序内容变为从磁盘中读取而不是从二进制中读取。

为了设置程序的参数，首先分配最必要的存储，然后将内容拷贝到栈上的正确的位置。

###设计实现基于”UNIX的硬链接和软链接机制“的概要设方案

软链接就是一个简单的常规文件，唯一不同的是它被使用SOFT\_LINK类型标记。在调用file\_open函数时，如果这个文件是一个目标文件，它的内容就可以被检查，当open\_file函数的内容和其路径相同时，它会被递归调用。

硬链接也是一个文件，他的disk_inode指向了实际文件的节点。另外，文件节点包含了一个额外的计数参考值，这个值标明了当前有多少硬连接正在指向这个文件。当一个路径被移除时，这个技术就会减少1，当它减少到0的时候，这个文件就会自动被移除。


