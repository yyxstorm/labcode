# 操作系统Lab3实验报告

2012011289
计22
姚宇轩


## 练习零：填写已有实验

我使用的是understand的diff/merge工具。具体操作流程为：菜单中选择Tools\Compare\Compare files/folders...进去之后，上面的选项栏选择lab2，下面的选择lab3。然后就可以看到两个工程有什么不一样了。当需要把lab2的内容merge进lab3时，只需要点击左侧的merge selection即可。

## 练习一：给未被映射的地址映射上物理页

### 我的设计实现过程
调用`get_pte`函数：根据给定的地址，查找相应的页表项。如果这个页表项不存在，那么创建一个页表项。如果创建失败，那么跳转到失败标志。
调用`pgdir_alloc_page`函数：如果物理地址不存在，那么分配一个页，并且将这个物理地址和逻辑地址映射起来。如果不能够分配，那么跳转到失败标志。


### 和标准答案的差别
跳转到失败标志的时候，没有输出错误信息。

### PDE和PTE中组成部分对ucore实现页替换算法的潜在用处
PDE和PTE的前20位是为了来寻找页表的，这个用处无需多言。
后面的一些位，如第二位PTE_W（可读写位），第三位PTE_U（用户态位），都是为了让操作系统可以判断这个缺页异常是为什么错，然后进行相应的处理。又比如说第七位PTE_D（脏块位），可以用以实现改进的时钟算法，选择换出时，就需要换出未修改过且未访问过的页面。

### 缺页服务例程在执行过程中出现页访问异常，硬件需要做哪些事情
记录当前的EPC等值，保持现场。然后难道不会崩溃吗……

## 练习二：实现寻找虚拟地址对应的页表项
### 我的设计实现过程
在`_fifo_map_swappable`函数中，将传入的页（最近访问页）连在双向链表上。在`_fifo_swap_out_victim`函数中，找到最后的一个页，将对应的链表项删除，并返回这个页面。

### 和标准答案的差别
答案直接使用`head->prev`，我使用了函数`list_prev`。

### 实现"extended clock页替换算法"
需要扩展，但不是在swap_manager框架中扩展，而是在Page中扩展，Page中有个flags参数，现在没有为它设置访问位和修改位，如果我们假设这个是有的话，那么就可以不用扩展了。依然获取一个head，按一个方向顺序遍历链表，获取页面，然后通过page的flags参数来判断。

- 需要被换出的页的特征是什么
访问过，且修改过。
- ucore中如何判断具有这样特征的页
通过flags中特殊的几位来判断。
- 何时进行换入和换出操作
发生缺页的时候。

## 重要知识点
- FIFO页替换算法
- 页和页表的分配
- 虚拟存储的概念，从硬盘中读写资源
- 缺页异常的处理流程




